on: [push]
jobs:
  test:
    runs-on: codeberg-medium
    container:
      image: ghcr.io/void-linux/void-glibc-full
      env:
        TERM: xterm-256color
        FORCE_COLOR: 1
        CLICOLOR_FORCE: 1
    steps:
      - name: Install dependencies as root
        run: |
          xbps-install -Syu xbps
          xbps-install -yu
          xbps-install -y nodejs bash dialog git gum ncurses shellcheck shfmt shadow sudo
          useradd -m -u 1000 -s /bin/bash runner
          echo "runner ALL=(ALL) NOPASSWD:ALL" >> /etc/sudoers
          
      - uses: actions/checkout@v4
      
      - name: Fix permissions and run as runner
        run: |
          chown -R runner:runner .
          sudo -u runner bash << 'EOF'
          export TERM=xterm-256color
          export FORCE_COLOR=1
          export CLICOLOR_FORCE=1
          chmod +x xut
          gum style --border rounded --border-foreground "#14a113" --padding "0 1" "shfmt -p xut"
          shfmt -p xut
          gum style --border rounded --border-foreground "#14a113" --padding "0 1" "shellcheck -S error xut"
          shellcheck -S error xut
          gum style --border rounded --border-foreground "#14a113" --padding "0 1" "xut -h"
          ./xut -h
          gum style --border rounded --border-foreground "#14a113" --padding "0 1" "xut -sl"
          ./xut -sl
          gum style --border rounded --border-foreground "#14a113" --padding "0 1" "xut -u"
          ./xut -u
          gum style --border rounded --border-foreground "#14a113" --padding "0 1" "xut -q bash"
          ./xut -q bash
          EOF